{"ast":null,"code":"'use strict';\n\nvar ip = require('./ip');\n\nvar protocols = require('./protocols-table');\n\nvar CID = require('cids');\n\nvar multibase = require('multibase');\n\nvar varint = require('varint');\n\nvar uint8ArrayToString = require('uint8arrays/to-string');\n\nvar uint8ArrayFromString = require('uint8arrays/from-string');\n\nvar uint8ArrayConcat = require('uint8arrays/concat');\n\nmodule.exports = Convert; // converts (serializes) addresses\n\nfunction Convert(proto, a) {\n  if (a instanceof Uint8Array) {\n    return Convert.toString(proto, a);\n  } else {\n    return Convert.toBytes(proto, a);\n  }\n}\n\nConvert.toString = function convertToString(proto, buf) {\n  proto = protocols(proto);\n\n  switch (proto.code) {\n    case 4: // ipv4\n\n    case 41:\n      // ipv6\n      return bytes2ip(buf);\n\n    case 6: // tcp\n\n    case 273: // udp\n\n    case 33: // dccp\n\n    case 132:\n      // sctp\n      return bytes2port(buf);\n\n    case 53: // dns\n\n    case 54: // dns4\n\n    case 55: // dns6\n\n    case 56: // dnsaddr\n\n    case 400: // unix\n\n    case 777:\n      // memory\n      return bytes2str(buf);\n\n    case 421:\n      // ipfs\n      return bytes2mh(buf);\n\n    case 444:\n      // onion\n      return bytes2onion(buf);\n\n    case 445:\n      // onion3\n      return bytes2onion(buf);\n\n    default:\n      return uint8ArrayToString(buf, 'base16');\n    // no clue. convert to hex\n  }\n};\n\nConvert.toBytes = function convertToBytes(proto, str) {\n  proto = protocols(proto);\n\n  switch (proto.code) {\n    case 4:\n      // ipv4\n      return ip2bytes(str);\n\n    case 41:\n      // ipv6\n      return ip2bytes(str);\n\n    case 6: // tcp\n\n    case 273: // udp\n\n    case 33: // dccp\n\n    case 132:\n      // sctp\n      return port2bytes(parseInt(str, 10));\n\n    case 53: // dns\n\n    case 54: // dns4\n\n    case 55: // dns6\n\n    case 56: // dnsaddr\n\n    case 400: // unix\n\n    case 777:\n      // memory\n      return str2bytes(str);\n\n    case 421:\n      // ipfs\n      return mh2bytes(str);\n\n    case 444:\n      // onion\n      return onion2bytes(str);\n\n    case 445:\n      // onion3\n      return onion32bytes(str);\n\n    default:\n      return uint8ArrayFromString(str, 'base16');\n    // no clue. convert from hex\n  }\n};\n\nfunction ip2bytes(ipString) {\n  if (!ip.isIP(ipString)) {\n    throw new Error('invalid ip address');\n  }\n\n  return ip.toBytes(ipString);\n}\n\nfunction bytes2ip(ipBuff) {\n  var ipString = ip.toString(ipBuff);\n\n  if (!ipString || !ip.isIP(ipString)) {\n    throw new Error('invalid ip address');\n  }\n\n  return ipString;\n}\n\nfunction port2bytes(port) {\n  var buf = new ArrayBuffer(2);\n  var view = new DataView(buf);\n  view.setUint16(0, port);\n  return new Uint8Array(buf);\n}\n\nfunction bytes2port(buf) {\n  var view = new DataView(buf.buffer);\n  return view.getUint16(0);\n}\n\nfunction str2bytes(str) {\n  var buf = uint8ArrayFromString(str);\n  var size = Uint8Array.from(varint.encode(buf.length));\n  return uint8ArrayConcat([size, buf], size.length + buf.length);\n}\n\nfunction bytes2str(buf) {\n  var size = varint.decode(buf);\n  buf = buf.slice(varint.decode.bytes);\n\n  if (buf.length !== size) {\n    throw new Error('inconsistent lengths');\n  }\n\n  return uint8ArrayToString(buf);\n}\n\nfunction mh2bytes(hash) {\n  // the address is a varint prefixed multihash string representation\n  var mh = new CID(hash).multihash;\n  var size = Uint8Array.from(varint.encode(mh.length));\n  return uint8ArrayConcat([size, mh], size.length + mh.length);\n}\n\nfunction bytes2mh(buf) {\n  var size = varint.decode(buf);\n  var address = buf.slice(varint.decode.bytes);\n\n  if (address.length !== size) {\n    throw new Error('inconsistent lengths');\n  }\n\n  return uint8ArrayToString(address, 'base58btc');\n}\n\nfunction onion2bytes(str) {\n  var addr = str.split(':');\n\n  if (addr.length !== 2) {\n    throw new Error('failed to parse onion addr: ' + addr + ' does not contain a port number');\n  }\n\n  if (addr[0].length !== 16) {\n    throw new Error('failed to parse onion addr: ' + addr[0] + ' not a Tor onion address.');\n  } // onion addresses do not include the multibase prefix, add it before decoding\n\n\n  var buf = multibase.decode('b' + addr[0]); // onion port number\n\n  var port = parseInt(addr[1], 10);\n\n  if (port < 1 || port > 65536) {\n    throw new Error('Port number is not in range(1, 65536)');\n  }\n\n  var portBuf = port2bytes(port);\n  return uint8ArrayConcat([buf, portBuf], buf.length + portBuf.length);\n}\n\nfunction onion32bytes(str) {\n  var addr = str.split(':');\n\n  if (addr.length !== 2) {\n    throw new Error('failed to parse onion addr: ' + addr + ' does not contain a port number');\n  }\n\n  if (addr[0].length !== 56) {\n    throw new Error('failed to parse onion addr: ' + addr[0] + ' not a Tor onion3 address.');\n  } // onion addresses do not include the multibase prefix, add it before decoding\n\n\n  var buf = multibase.decode('b' + addr[0]); // onion port number\n\n  var port = parseInt(addr[1], 10);\n\n  if (port < 1 || port > 65536) {\n    throw new Error('Port number is not in range(1, 65536)');\n  }\n\n  var portBuf = port2bytes(port);\n  return uint8ArrayConcat([buf, portBuf], buf.length + portBuf.length);\n}\n\nfunction bytes2onion(buf) {\n  var addrBytes = buf.slice(0, buf.length - 2);\n  var portBytes = buf.slice(buf.length - 2);\n  var addr = uint8ArrayToString(addrBytes, 'base32');\n  var port = bytes2port(portBytes);\n  return addr + ':' + port;\n}","map":{"version":3,"sources":["/home/thalusa/Documents/ResearchShare-v2/node_modules/multiaddr/src/convert.js"],"names":["ip","require","protocols","CID","multibase","varint","uint8ArrayToString","uint8ArrayFromString","uint8ArrayConcat","module","exports","Convert","proto","a","Uint8Array","toString","toBytes","convertToString","buf","code","bytes2ip","bytes2port","bytes2str","bytes2mh","bytes2onion","convertToBytes","str","ip2bytes","port2bytes","parseInt","str2bytes","mh2bytes","onion2bytes","onion32bytes","ipString","isIP","Error","ipBuff","port","ArrayBuffer","view","DataView","setUint16","buffer","getUint16","size","from","encode","length","decode","slice","bytes","hash","mh","multihash","address","addr","split","portBuf","addrBytes","portBytes"],"mappings":"AAAA;;AAEA,IAAMA,EAAE,GAAGC,OAAO,CAAC,MAAD,CAAlB;;AACA,IAAMC,SAAS,GAAGD,OAAO,CAAC,mBAAD,CAAzB;;AACA,IAAME,GAAG,GAAGF,OAAO,CAAC,MAAD,CAAnB;;AACA,IAAMG,SAAS,GAAGH,OAAO,CAAC,WAAD,CAAzB;;AACA,IAAMI,MAAM,GAAGJ,OAAO,CAAC,QAAD,CAAtB;;AACA,IAAMK,kBAAkB,GAAGL,OAAO,CAAC,uBAAD,CAAlC;;AACA,IAAMM,oBAAoB,GAAGN,OAAO,CAAC,yBAAD,CAApC;;AACA,IAAMO,gBAAgB,GAAGP,OAAO,CAAC,oBAAD,CAAhC;;AAEAQ,MAAM,CAACC,OAAP,GAAiBC,OAAjB,C,CAEA;;AACA,SAASA,OAAT,CAAkBC,KAAlB,EAAyBC,CAAzB,EAA4B;AAC1B,MAAIA,CAAC,YAAYC,UAAjB,EAA6B;AAC3B,WAAOH,OAAO,CAACI,QAAR,CAAiBH,KAAjB,EAAwBC,CAAxB,CAAP;AACD,GAFD,MAEO;AACL,WAAOF,OAAO,CAACK,OAAR,CAAgBJ,KAAhB,EAAuBC,CAAvB,CAAP;AACD;AACF;;AAEDF,OAAO,CAACI,QAAR,GAAmB,SAASE,eAAT,CAA0BL,KAA1B,EAAiCM,GAAjC,EAAsC;AACvDN,EAAAA,KAAK,GAAGV,SAAS,CAACU,KAAD,CAAjB;;AACA,UAAQA,KAAK,CAACO,IAAd;AACE,SAAK,CAAL,CADF,CACU;;AACR,SAAK,EAAL;AAAS;AACP,aAAOC,QAAQ,CAACF,GAAD,CAAf;;AAEF,SAAK,CAAL,CALF,CAKU;;AACR,SAAK,GAAL,CANF,CAMY;;AACV,SAAK,EAAL,CAPF,CAOW;;AACT,SAAK,GAAL;AAAU;AACR,aAAOG,UAAU,CAACH,GAAD,CAAjB;;AAEF,SAAK,EAAL,CAXF,CAWW;;AACT,SAAK,EAAL,CAZF,CAYW;;AACT,SAAK,EAAL,CAbF,CAaW;;AACT,SAAK,EAAL,CAdF,CAcW;;AACT,SAAK,GAAL,CAfF,CAeY;;AACV,SAAK,GAAL;AAAU;AACR,aAAOI,SAAS,CAACJ,GAAD,CAAhB;;AAEF,SAAK,GAAL;AAAU;AACR,aAAOK,QAAQ,CAACL,GAAD,CAAf;;AACF,SAAK,GAAL;AAAU;AACR,aAAOM,WAAW,CAACN,GAAD,CAAlB;;AACF,SAAK,GAAL;AAAU;AACR,aAAOM,WAAW,CAACN,GAAD,CAAlB;;AACF;AACE,aAAOZ,kBAAkB,CAACY,GAAD,EAAM,QAAN,CAAzB;AAAyC;AA1B7C;AA4BD,CA9BD;;AAgCAP,OAAO,CAACK,OAAR,GAAkB,SAASS,cAAT,CAAyBb,KAAzB,EAAgCc,GAAhC,EAAqC;AACrDd,EAAAA,KAAK,GAAGV,SAAS,CAACU,KAAD,CAAjB;;AACA,UAAQA,KAAK,CAACO,IAAd;AACE,SAAK,CAAL;AAAQ;AACN,aAAOQ,QAAQ,CAACD,GAAD,CAAf;;AACF,SAAK,EAAL;AAAS;AACP,aAAOC,QAAQ,CAACD,GAAD,CAAf;;AAEF,SAAK,CAAL,CANF,CAMU;;AACR,SAAK,GAAL,CAPF,CAOY;;AACV,SAAK,EAAL,CARF,CAQW;;AACT,SAAK,GAAL;AAAU;AACR,aAAOE,UAAU,CAACC,QAAQ,CAACH,GAAD,EAAM,EAAN,CAAT,CAAjB;;AAEF,SAAK,EAAL,CAZF,CAYW;;AACT,SAAK,EAAL,CAbF,CAaW;;AACT,SAAK,EAAL,CAdF,CAcW;;AACT,SAAK,EAAL,CAfF,CAeW;;AACT,SAAK,GAAL,CAhBF,CAgBY;;AACV,SAAK,GAAL;AAAU;AACR,aAAOI,SAAS,CAACJ,GAAD,CAAhB;;AAEF,SAAK,GAAL;AAAU;AACR,aAAOK,QAAQ,CAACL,GAAD,CAAf;;AACF,SAAK,GAAL;AAAU;AACR,aAAOM,WAAW,CAACN,GAAD,CAAlB;;AACF,SAAK,GAAL;AAAU;AACR,aAAOO,YAAY,CAACP,GAAD,CAAnB;;AACF;AACE,aAAOnB,oBAAoB,CAACmB,GAAD,EAAM,QAAN,CAA3B;AAA2C;AA3B/C;AA6BD,CA/BD;;AAiCA,SAASC,QAAT,CAAmBO,QAAnB,EAA6B;AAC3B,MAAI,CAAClC,EAAE,CAACmC,IAAH,CAAQD,QAAR,CAAL,EAAwB;AACtB,UAAM,IAAIE,KAAJ,CAAU,oBAAV,CAAN;AACD;;AACD,SAAOpC,EAAE,CAACgB,OAAH,CAAWkB,QAAX,CAAP;AACD;;AAED,SAASd,QAAT,CAAmBiB,MAAnB,EAA2B;AACzB,MAAMH,QAAQ,GAAGlC,EAAE,CAACe,QAAH,CAAYsB,MAAZ,CAAjB;;AACA,MAAI,CAACH,QAAD,IAAa,CAAClC,EAAE,CAACmC,IAAH,CAAQD,QAAR,CAAlB,EAAqC;AACnC,UAAM,IAAIE,KAAJ,CAAU,oBAAV,CAAN;AACD;;AACD,SAAOF,QAAP;AACD;;AAED,SAASN,UAAT,CAAqBU,IAArB,EAA2B;AACzB,MAAMpB,GAAG,GAAG,IAAIqB,WAAJ,CAAgB,CAAhB,CAAZ;AACA,MAAMC,IAAI,GAAG,IAAIC,QAAJ,CAAavB,GAAb,CAAb;AACAsB,EAAAA,IAAI,CAACE,SAAL,CAAe,CAAf,EAAkBJ,IAAlB;AAEA,SAAO,IAAIxB,UAAJ,CAAeI,GAAf,CAAP;AACD;;AAED,SAASG,UAAT,CAAqBH,GAArB,EAA0B;AACxB,MAAMsB,IAAI,GAAG,IAAIC,QAAJ,CAAavB,GAAG,CAACyB,MAAjB,CAAb;AACA,SAAOH,IAAI,CAACI,SAAL,CAAe,CAAf,CAAP;AACD;;AAED,SAASd,SAAT,CAAoBJ,GAApB,EAAyB;AACvB,MAAMR,GAAG,GAAGX,oBAAoB,CAACmB,GAAD,CAAhC;AACA,MAAMmB,IAAI,GAAG/B,UAAU,CAACgC,IAAX,CAAgBzC,MAAM,CAAC0C,MAAP,CAAc7B,GAAG,CAAC8B,MAAlB,CAAhB,CAAb;AACA,SAAOxC,gBAAgB,CAAC,CAACqC,IAAD,EAAO3B,GAAP,CAAD,EAAc2B,IAAI,CAACG,MAAL,GAAc9B,GAAG,CAAC8B,MAAhC,CAAvB;AACD;;AAED,SAAS1B,SAAT,CAAoBJ,GAApB,EAAyB;AACvB,MAAM2B,IAAI,GAAGxC,MAAM,CAAC4C,MAAP,CAAc/B,GAAd,CAAb;AACAA,EAAAA,GAAG,GAAGA,GAAG,CAACgC,KAAJ,CAAU7C,MAAM,CAAC4C,MAAP,CAAcE,KAAxB,CAAN;;AAEA,MAAIjC,GAAG,CAAC8B,MAAJ,KAAeH,IAAnB,EAAyB;AACvB,UAAM,IAAIT,KAAJ,CAAU,sBAAV,CAAN;AACD;;AAED,SAAO9B,kBAAkB,CAACY,GAAD,CAAzB;AACD;;AAED,SAASa,QAAT,CAAmBqB,IAAnB,EAAyB;AACvB;AACA,MAAMC,EAAE,GAAG,IAAIlD,GAAJ,CAAQiD,IAAR,EAAcE,SAAzB;AACA,MAAMT,IAAI,GAAG/B,UAAU,CAACgC,IAAX,CAAgBzC,MAAM,CAAC0C,MAAP,CAAcM,EAAE,CAACL,MAAjB,CAAhB,CAAb;AACA,SAAOxC,gBAAgB,CAAC,CAACqC,IAAD,EAAOQ,EAAP,CAAD,EAAaR,IAAI,CAACG,MAAL,GAAcK,EAAE,CAACL,MAA9B,CAAvB;AACD;;AAED,SAASzB,QAAT,CAAmBL,GAAnB,EAAwB;AACtB,MAAM2B,IAAI,GAAGxC,MAAM,CAAC4C,MAAP,CAAc/B,GAAd,CAAb;AACA,MAAMqC,OAAO,GAAGrC,GAAG,CAACgC,KAAJ,CAAU7C,MAAM,CAAC4C,MAAP,CAAcE,KAAxB,CAAhB;;AAEA,MAAII,OAAO,CAACP,MAAR,KAAmBH,IAAvB,EAA6B;AAC3B,UAAM,IAAIT,KAAJ,CAAU,sBAAV,CAAN;AACD;;AAED,SAAO9B,kBAAkB,CAACiD,OAAD,EAAU,WAAV,CAAzB;AACD;;AAED,SAASvB,WAAT,CAAsBN,GAAtB,EAA2B;AACzB,MAAM8B,IAAI,GAAG9B,GAAG,CAAC+B,KAAJ,CAAU,GAAV,CAAb;;AACA,MAAID,IAAI,CAACR,MAAL,KAAgB,CAApB,EAAuB;AACrB,UAAM,IAAIZ,KAAJ,CAAU,iCAAiCoB,IAAjC,GAAwC,iCAAlD,CAAN;AACD;;AACD,MAAIA,IAAI,CAAC,CAAD,CAAJ,CAAQR,MAAR,KAAmB,EAAvB,EAA2B;AACzB,UAAM,IAAIZ,KAAJ,CAAU,iCAAiCoB,IAAI,CAAC,CAAD,CAArC,GAA2C,2BAArD,CAAN;AACD,GAPwB,CASzB;;;AACA,MAAMtC,GAAG,GAAGd,SAAS,CAAC6C,MAAV,CAAiB,MAAMO,IAAI,CAAC,CAAD,CAA3B,CAAZ,CAVyB,CAYzB;;AACA,MAAMlB,IAAI,GAAGT,QAAQ,CAAC2B,IAAI,CAAC,CAAD,CAAL,EAAU,EAAV,CAArB;;AACA,MAAIlB,IAAI,GAAG,CAAP,IAAYA,IAAI,GAAG,KAAvB,EAA8B;AAC5B,UAAM,IAAIF,KAAJ,CAAU,uCAAV,CAAN;AACD;;AACD,MAAMsB,OAAO,GAAG9B,UAAU,CAACU,IAAD,CAA1B;AACA,SAAO9B,gBAAgB,CAAC,CAACU,GAAD,EAAMwC,OAAN,CAAD,EAAiBxC,GAAG,CAAC8B,MAAJ,GAAaU,OAAO,CAACV,MAAtC,CAAvB;AACD;;AAED,SAASf,YAAT,CAAuBP,GAAvB,EAA4B;AAC1B,MAAM8B,IAAI,GAAG9B,GAAG,CAAC+B,KAAJ,CAAU,GAAV,CAAb;;AACA,MAAID,IAAI,CAACR,MAAL,KAAgB,CAApB,EAAuB;AACrB,UAAM,IAAIZ,KAAJ,CAAU,iCAAiCoB,IAAjC,GAAwC,iCAAlD,CAAN;AACD;;AACD,MAAIA,IAAI,CAAC,CAAD,CAAJ,CAAQR,MAAR,KAAmB,EAAvB,EAA2B;AACzB,UAAM,IAAIZ,KAAJ,CAAU,iCAAiCoB,IAAI,CAAC,CAAD,CAArC,GAA2C,4BAArD,CAAN;AACD,GAPyB,CAQ1B;;;AACA,MAAMtC,GAAG,GAAGd,SAAS,CAAC6C,MAAV,CAAiB,MAAMO,IAAI,CAAC,CAAD,CAA3B,CAAZ,CAT0B,CAW1B;;AACA,MAAMlB,IAAI,GAAGT,QAAQ,CAAC2B,IAAI,CAAC,CAAD,CAAL,EAAU,EAAV,CAArB;;AACA,MAAIlB,IAAI,GAAG,CAAP,IAAYA,IAAI,GAAG,KAAvB,EAA8B;AAC5B,UAAM,IAAIF,KAAJ,CAAU,uCAAV,CAAN;AACD;;AACD,MAAMsB,OAAO,GAAG9B,UAAU,CAACU,IAAD,CAA1B;AACA,SAAO9B,gBAAgB,CAAC,CAACU,GAAD,EAAMwC,OAAN,CAAD,EAAiBxC,GAAG,CAAC8B,MAAJ,GAAaU,OAAO,CAACV,MAAtC,CAAvB;AACD;;AAED,SAASxB,WAAT,CAAsBN,GAAtB,EAA2B;AACzB,MAAMyC,SAAS,GAAGzC,GAAG,CAACgC,KAAJ,CAAU,CAAV,EAAahC,GAAG,CAAC8B,MAAJ,GAAa,CAA1B,CAAlB;AACA,MAAMY,SAAS,GAAG1C,GAAG,CAACgC,KAAJ,CAAUhC,GAAG,CAAC8B,MAAJ,GAAa,CAAvB,CAAlB;AACA,MAAMQ,IAAI,GAAGlD,kBAAkB,CAACqD,SAAD,EAAY,QAAZ,CAA/B;AACA,MAAMrB,IAAI,GAAGjB,UAAU,CAACuC,SAAD,CAAvB;AACA,SAAOJ,IAAI,GAAG,GAAP,GAAalB,IAApB;AACD","sourcesContent":["'use strict'\n\nconst ip = require('./ip')\nconst protocols = require('./protocols-table')\nconst CID = require('cids')\nconst multibase = require('multibase')\nconst varint = require('varint')\nconst uint8ArrayToString = require('uint8arrays/to-string')\nconst uint8ArrayFromString = require('uint8arrays/from-string')\nconst uint8ArrayConcat = require('uint8arrays/concat')\n\nmodule.exports = Convert\n\n// converts (serializes) addresses\nfunction Convert (proto, a) {\n  if (a instanceof Uint8Array) {\n    return Convert.toString(proto, a)\n  } else {\n    return Convert.toBytes(proto, a)\n  }\n}\n\nConvert.toString = function convertToString (proto, buf) {\n  proto = protocols(proto)\n  switch (proto.code) {\n    case 4: // ipv4\n    case 41: // ipv6\n      return bytes2ip(buf)\n\n    case 6: // tcp\n    case 273: // udp\n    case 33: // dccp\n    case 132: // sctp\n      return bytes2port(buf)\n\n    case 53: // dns\n    case 54: // dns4\n    case 55: // dns6\n    case 56: // dnsaddr\n    case 400: // unix\n    case 777: // memory\n      return bytes2str(buf)\n\n    case 421: // ipfs\n      return bytes2mh(buf)\n    case 444: // onion\n      return bytes2onion(buf)\n    case 445: // onion3\n      return bytes2onion(buf)\n    default:\n      return uint8ArrayToString(buf, 'base16') // no clue. convert to hex\n  }\n}\n\nConvert.toBytes = function convertToBytes (proto, str) {\n  proto = protocols(proto)\n  switch (proto.code) {\n    case 4: // ipv4\n      return ip2bytes(str)\n    case 41: // ipv6\n      return ip2bytes(str)\n\n    case 6: // tcp\n    case 273: // udp\n    case 33: // dccp\n    case 132: // sctp\n      return port2bytes(parseInt(str, 10))\n\n    case 53: // dns\n    case 54: // dns4\n    case 55: // dns6\n    case 56: // dnsaddr\n    case 400: // unix\n    case 777: // memory\n      return str2bytes(str)\n\n    case 421: // ipfs\n      return mh2bytes(str)\n    case 444: // onion\n      return onion2bytes(str)\n    case 445: // onion3\n      return onion32bytes(str)\n    default:\n      return uint8ArrayFromString(str, 'base16') // no clue. convert from hex\n  }\n}\n\nfunction ip2bytes (ipString) {\n  if (!ip.isIP(ipString)) {\n    throw new Error('invalid ip address')\n  }\n  return ip.toBytes(ipString)\n}\n\nfunction bytes2ip (ipBuff) {\n  const ipString = ip.toString(ipBuff)\n  if (!ipString || !ip.isIP(ipString)) {\n    throw new Error('invalid ip address')\n  }\n  return ipString\n}\n\nfunction port2bytes (port) {\n  const buf = new ArrayBuffer(2)\n  const view = new DataView(buf)\n  view.setUint16(0, port)\n\n  return new Uint8Array(buf)\n}\n\nfunction bytes2port (buf) {\n  const view = new DataView(buf.buffer)\n  return view.getUint16(0)\n}\n\nfunction str2bytes (str) {\n  const buf = uint8ArrayFromString(str)\n  const size = Uint8Array.from(varint.encode(buf.length))\n  return uint8ArrayConcat([size, buf], size.length + buf.length)\n}\n\nfunction bytes2str (buf) {\n  const size = varint.decode(buf)\n  buf = buf.slice(varint.decode.bytes)\n\n  if (buf.length !== size) {\n    throw new Error('inconsistent lengths')\n  }\n\n  return uint8ArrayToString(buf)\n}\n\nfunction mh2bytes (hash) {\n  // the address is a varint prefixed multihash string representation\n  const mh = new CID(hash).multihash\n  const size = Uint8Array.from(varint.encode(mh.length))\n  return uint8ArrayConcat([size, mh], size.length + mh.length)\n}\n\nfunction bytes2mh (buf) {\n  const size = varint.decode(buf)\n  const address = buf.slice(varint.decode.bytes)\n\n  if (address.length !== size) {\n    throw new Error('inconsistent lengths')\n  }\n\n  return uint8ArrayToString(address, 'base58btc')\n}\n\nfunction onion2bytes (str) {\n  const addr = str.split(':')\n  if (addr.length !== 2) {\n    throw new Error('failed to parse onion addr: ' + addr + ' does not contain a port number')\n  }\n  if (addr[0].length !== 16) {\n    throw new Error('failed to parse onion addr: ' + addr[0] + ' not a Tor onion address.')\n  }\n\n  // onion addresses do not include the multibase prefix, add it before decoding\n  const buf = multibase.decode('b' + addr[0])\n\n  // onion port number\n  const port = parseInt(addr[1], 10)\n  if (port < 1 || port > 65536) {\n    throw new Error('Port number is not in range(1, 65536)')\n  }\n  const portBuf = port2bytes(port)\n  return uint8ArrayConcat([buf, portBuf], buf.length + portBuf.length)\n}\n\nfunction onion32bytes (str) {\n  const addr = str.split(':')\n  if (addr.length !== 2) {\n    throw new Error('failed to parse onion addr: ' + addr + ' does not contain a port number')\n  }\n  if (addr[0].length !== 56) {\n    throw new Error('failed to parse onion addr: ' + addr[0] + ' not a Tor onion3 address.')\n  }\n  // onion addresses do not include the multibase prefix, add it before decoding\n  const buf = multibase.decode('b' + addr[0])\n\n  // onion port number\n  const port = parseInt(addr[1], 10)\n  if (port < 1 || port > 65536) {\n    throw new Error('Port number is not in range(1, 65536)')\n  }\n  const portBuf = port2bytes(port)\n  return uint8ArrayConcat([buf, portBuf], buf.length + portBuf.length)\n}\n\nfunction bytes2onion (buf) {\n  const addrBytes = buf.slice(0, buf.length - 2)\n  const portBytes = buf.slice(buf.length - 2)\n  const addr = uint8ArrayToString(addrBytes, 'base32')\n  const port = bytes2port(portBytes)\n  return addr + ':' + port\n}\n"]},"metadata":{},"sourceType":"script"}
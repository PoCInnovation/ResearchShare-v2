(function (root, factory) {(typeof module === 'object' && module.exports) ? module.exports = factory() : root.InterfaceDatastore = factory()}(typeof self !== 'undefined' ? self : this, function () {
var InterfaceDatastore=(()=>{var Ce=Object.defineProperty;var P=(t,e)=>()=>(t&&(e=t(t=0)),e),c=(t,e)=>()=>(e||t((e={exports:{}}).exports,e),e.exports),We=(t,e)=>{for(var r in e)Ce(t,r,{get:e[r],enumerable:!0})};var K,G=P(()=>{K="ModuleSymbhasOwnPr-0123456789ABCDEFGHNRVfgctiUvz_KqYTJkLxpZXIjQW"});var I={};We(I,{customAlphabet:()=>Ve,customRandom:()=>Q,nanoid:()=>Pe,random:()=>J,urlAlphabet:()=>K});var J,Q,Ve,Pe,M=P(()=>{G();J=t=>crypto.getRandomValues(new Uint8Array(t)),Q=(t,e,r)=>{let n=(2<<Math.log(t.length-1)/Math.LN2)-1,i=-~(1.6*n*e/t.length);return()=>{let o="";for(;;){let s=r(i),f=i;for(;f--;)if(o+=t[s[f]&n]||"",o.length===e)return o}}},Ve=(t,e)=>Q(t,e,J),Pe=(t=21)=>{let e="",r=crypto.getRandomValues(new Uint8Array(t));for(;t--;){let n=r[t]&63;n<36?e+=n.toString(36):n<62?e+=(n-26).toString(36).toUpperCase():n<63?e+="_":e+="-"}return e}});var Y=c((rr,X)=>{"use strict";function Ke(t){if(t.length>=255)throw new TypeError("Alphabet too long");for(var e=new Uint8Array(256),r=0;r<e.length;r++)e[r]=255;for(var n=0;n<t.length;n++){var i=t.charAt(n),o=i.charCodeAt(0);if(e[o]!==255)throw new TypeError(i+" is ambiguous");e[o]=n}var s=t.length,f=t.charAt(0),S=Math.log(s)/Math.log(256),p=Math.log(256)/Math.log(s);function R(a){if(a instanceof Uint8Array||(ArrayBuffer.isView(a)?a=new Uint8Array(a.buffer,a.byteOffset,a.byteLength):Array.isArray(a)&&(a=Uint8Array.from(a))),!(a instanceof Uint8Array))throw new TypeError("Expected Uint8Array");if(a.length===0)return"";for(var l=0,U=0,y=0,g=a.length;y!==g&&a[y]===0;)y++,l++;for(var m=(g-y)*p+1>>>0,d=new Uint8Array(m);y!==g;){for(var b=a[y],A=0,w=m-1;(b!==0||A<U)&&w!==-1;w--,A++)b+=256*d[w]>>>0,d[w]=b%s>>>0,b=b/s>>>0;if(b!==0)throw new Error("Non-zero carry");U=A,y++}for(var E=m-U;E!==m&&d[E]===0;)E++;for(var F=f.repeat(l);E<m;++E)F+=t.charAt(d[E]);return F}function V(a){if(typeof a!="string")throw new TypeError("Expected String");if(a.length===0)return new Uint8Array;var l=0;if(a[l]!==" "){for(var U=0,y=0;a[l]===f;)U++,l++;for(var g=(a.length-l)*S+1>>>0,m=new Uint8Array(g);a[l];){var d=e[a.charCodeAt(l)];if(d===255)return;for(var b=0,A=g-1;(d!==0||b<y)&&A!==-1;A--,b++)d+=s*m[A]>>>0,m[A]=d%256>>>0,d=d/256>>>0;if(d!==0)throw new Error("Non-zero carry");y=b,l++}if(a[l]!==" "){for(var w=g-y;w!==g&&m[w]===0;)w++;for(var E=new Uint8Array(U+(g-w)),F=U;w!==g;)E[F++]=m[w++];return E}}}function ze(a){var l=V(a);if(l)return l;throw new Error("Non-base"+s+" character")}return{encode:R,decodeUnsafe:V,decode:ze}}X.exports=Ke});var N=c((nr,Z)=>{"use strict";var Ge=new TextDecoder,Je=t=>Ge.decode(t),Qe=new TextEncoder,Xe=t=>Qe.encode(t);function Ye(t,e){let r=new Uint8Array(e),n=0;for(let i of t)r.set(i,n),n+=i.length;return r}Z.exports={decodeText:Je,encodeText:Xe,concat:Ye}});var ee=c((ir,H)=>{"use strict";var{encodeText:Ze}=N(),$=class{constructor(e,r,n,i){this.name=e,this.code=r,this.codeBuf=Ze(this.code),this.alphabet=i,this.codec=n(i)}encode(e){return this.codec.encode(e)}decode(e){for(let r of e)if(this.alphabet&&this.alphabet.indexOf(r)<0)throw new Error(`invalid character '${r}' in '${e}'`);return this.codec.decode(e)}};H.exports=$});var re=c((or,te)=>{"use strict";var He=(t,e,r)=>{let n={};for(let p=0;p<e.length;++p)n[e[p]]=p;let i=t.length;for(;t[i-1]==="=";)--i;let o=new Uint8Array(i*r/8|0),s=0,f=0,S=0;for(let p=0;p<i;++p){let R=n[t[p]];if(R===void 0)throw new SyntaxError("Invalid character "+t[p]);f=f<<r|R,s+=r,s>=8&&(s-=8,o[S++]=255&f>>s)}if(s>=r||255&f<<8-s)throw new SyntaxError("Unexpected end of data");return o},$e=(t,e,r)=>{let n=e[e.length-1]==="=",i=(1<<r)-1,o="",s=0,f=0;for(let S=0;S<t.length;++S)for(f=f<<8|t[S],s+=8;s>r;)s-=r,o+=e[i&f>>s];if(s&&(o+=e[i&f<<r-s]),n)for(;o.length*r&7;)o+="=";return o},et=t=>e=>({encode(r){return $e(r,e,t)},decode(r){return He(r,e,t)}});te.exports={rfc4648:et}});var se=c((sr,ne)=>{"use strict";var j=Y(),tt=ee(),{rfc4648:u}=re(),{decodeText:rt,encodeText:nt}=N(),it=()=>({encode:rt,decode:nt}),ie=[["identity","\0",it,""],["base2","0",u(1),"01"],["base8","7",u(3),"01234567"],["base10","9",j,"0123456789"],["base16","f",u(4),"0123456789abcdef"],["base16upper","F",u(4),"0123456789ABCDEF"],["base32hex","v",u(5),"0123456789abcdefghijklmnopqrstuv"],["base32hexupper","V",u(5),"0123456789ABCDEFGHIJKLMNOPQRSTUV"],["base32hexpad","t",u(5),"0123456789abcdefghijklmnopqrstuv="],["base32hexpadupper","T",u(5),"0123456789ABCDEFGHIJKLMNOPQRSTUV="],["base32","b",u(5),"abcdefghijklmnopqrstuvwxyz234567"],["base32upper","B",u(5),"ABCDEFGHIJKLMNOPQRSTUVWXYZ234567"],["base32pad","c",u(5),"abcdefghijklmnopqrstuvwxyz234567="],["base32padupper","C",u(5),"ABCDEFGHIJKLMNOPQRSTUVWXYZ234567="],["base32z","h",u(5),"ybndrfg8ejkmcpqxot1uwisza345h769"],["base36","k",j,"0123456789abcdefghijklmnopqrstuvwxyz"],["base36upper","K",j,"0123456789ABCDEFGHIJKLMNOPQRSTUVWXYZ"],["base58btc","z",j,"123456789ABCDEFGHJKLMNPQRSTUVWXYZabcdefghijkmnopqrstuvwxyz"],["base58flickr","Z",j,"123456789abcdefghijkmnopqrstuvwxyzABCDEFGHJKLMNPQRSTUVWXYZ"],["base64","m",u(6),"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/"],["base64pad","M",u(6),"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/="],["base64url","u",u(6),"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789-_"],["base64urlpad","U",u(6),"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789-_="]],oe=ie.reduce((t,e)=>(t[e[0]]=new tt(e[0],e[1],e[2],e[3]),t),{}),ot=ie.reduce((t,e)=>(t[e[1]]=oe[e[0]],t),{});ne.exports={names:oe,codes:ot}});var B=c((x,ae)=>{"use strict";var T=se(),{encodeText:st,decodeText:O,concat:ce}=N();function ct(t,e){if(!e)throw new Error("requires an encoded Uint8Array");let{name:r,codeBuf:n}=D(t);return at(r,e),ce([n,e],n.length+e.length)}function ut(t,e){let r=D(t),n=st(r.encode(e));return ce([r.codeBuf,n],r.codeBuf.length+n.length)}function ft(t){t instanceof Uint8Array&&(t=O(t));let e=t[0];return["f","F","v","V","t","T","b","B","c","C","h","k","K"].includes(e)&&(t=t.toLowerCase()),D(t[0]).decode(t.substring(1))}function lt(t){if(t instanceof Uint8Array&&(t=O(t)),Object.prototype.toString.call(t)!=="[object String]")return!1;try{return D(t[0]).name}catch(e){return!1}}function at(t,e){D(t).decode(O(e))}function D(t){if(Object.prototype.hasOwnProperty.call(T.names,t))return T.names[t];if(Object.prototype.hasOwnProperty.call(T.codes,t))return T.codes[t];throw new Error(`Unsupported encoding: ${t}`)}function dt(t){return t instanceof Uint8Array&&(t=O(t)),D(t[0])}x=ae.exports=ct;x.encode=ut;x.decode=ft;x.isEncoded=lt;x.encoding=D;x.encodingFromData=dt;var ht=Object.freeze(T.names),pt=Object.freeze(T.codes);x.names=ht;x.codes=pt});var fe=c((ar,ue)=>{"use strict";var{encoding:yt}=B(),wt=new TextDecoder("utf8");function gt(t){let e="";for(let r=0;r<t.length;r++)e+=String.fromCharCode(t[r]);return e}function mt(t,e="utf8"){return e==="utf8"||e==="utf-8"?wt.decode(t):e==="ascii"?gt(t):yt(e).encode(t)}ue.exports=mt});var de=c((cr,le)=>{"use strict";var{encoding:bt}=B(),Et=new TextEncoder;function xt(t){let e=new Uint8Array(t.length);for(let r=0;r<t.length;r++)e[r]=t.charCodeAt(r);return e}function vt(t,e="utf8"){return e==="utf8"||e==="utf-8"?Et.encode(t):e==="ascii"?xt(t):bt(e).decode(t)}le.exports=vt});var L=c((ur,he)=>{"use strict";var{nanoid:At}=(M(),I),St=fe(),Ut=de(),v="/",pe=new TextEncoder().encode(v),q=pe[0],h=class{constructor(e,r){if(typeof e=="string")this._buf=Ut(e);else if(e instanceof Uint8Array)this._buf=e;else throw new Error("Invalid key, should be String of Uint8Array");if(r==null&&(r=!0),r&&this.clean(),this._buf.byteLength===0||this._buf[0]!==q)throw new Error("Invalid key")}toString(e="utf8"){return St(this._buf,e)}uint8Array(){return this._buf}get[Symbol.toStringTag](){return`Key(${this.toString()})`}static withNamespaces(e){return new h(e.join(v))}static random(){return new h(At().replace(/-/g,""))}clean(){if((!this._buf||this._buf.byteLength===0)&&(this._buf=pe),this._buf[0]!==q){let e=new Uint8Array(this._buf.byteLength+1);e.fill(q,0,1),e.set(this._buf,1),this._buf=e}for(;this._buf.byteLength>1&&this._buf[this._buf.byteLength-1]===q;)this._buf=this._buf.subarray(0,-1)}less(e){let r=this.list(),n=e.list();for(let i=0;i<r.length;i++){if(n.length<i+1)return!1;let o=r[i],s=n[i];if(o<s)return!0;if(o>s)return!1}return r.length<n.length}reverse(){return h.withNamespaces(this.list().slice().reverse())}namespaces(){return this.list()}baseNamespace(){let e=this.namespaces();return e[e.length-1]}list(){return this.toString().split(v).slice(1)}type(){return Dt(this.baseNamespace())}name(){return Tt(this.baseNamespace())}instance(e){return new h(this.toString()+":"+e)}path(){let e=this.parent().toString();return e.endsWith(v)||(e+=v),e+=this.type(),new h(e)}parent(){let e=this.list();return e.length===1?new h(v):new h(e.slice(0,-1).join(v))}child(e){return this.toString()===v?e:e.toString()===v?this:new h(this.toString()+e.toString(),!1)}isAncestorOf(e){return e.toString()===this.toString()?!1:e.toString().startsWith(this.toString())}isDecendantOf(e){return e.toString()===this.toString()?!1:this.toString().startsWith(e.toString())}isTopLevel(){return this.list().length===1}concat(...e){return h.withNamespaces([...this.namespaces(),..._t(e.map(r=>r.namespaces()))])}};function Dt(t){let e=t.split(":");return e.length<2?"":e.slice(0,-1).join(":")}function Tt(t){let e=t.split(":");return e[e.length-1]}function _t(t){return[].concat(...t)}he.exports=h});var we=c((fr,ye)=>{"use strict";var{nanoid:jt}=(M(),I),kt=(t=e=>e)=>t(jt());ye.exports=kt});var me=c((lr,ge)=>{"use strict";var Rt=async t=>{let e=[];for await(let r of t)e.push(r);return e};ge.exports=Rt});var z=c((dr,be)=>{"use strict";var Ft=we(),Nt=me(),Ot=(t,e)=>async function*(){yield*(await Nt(t)).sort(e)}(),qt=(t,e)=>{let r=new RegExp("^"+e);return t.replace(r,"")};be.exports={sortAll:Ot,tmpdir:Ft,replaceStartWith:qt}});var xe=c((hr,Ee)=>{"use strict";var It=async t=>{for await(let e of t);};Ee.exports=It});var Ae=c((pr,ve)=>{"use strict";var Mt=async function*(t,e){for await(let r of t)await e(r)&&(yield r)};ve.exports=Mt});var Ue=c((yr,Se)=>{"use strict";var Bt=async function*(t,e){let r=0;if(!(e<1)){for await(let n of t)if(yield n,r++,r===e)return}};Se.exports=Bt});var C=c((wr,De)=>{"use strict";var{sortAll:Te}=z(),_e=xe(),_=Ae(),je=Ue(),ke=class{open(){return Promise.reject(new Error(".open is not implemented"))}close(){return Promise.reject(new Error(".close is not implemented"))}put(e,r,n){return Promise.reject(new Error(".put is not implemented"))}get(e,r){return Promise.reject(new Error(".get is not implemented"))}has(e,r){return Promise.reject(new Error(".has is not implemented"))}delete(e,r){return Promise.reject(new Error(".delete is not implemented"))}async*putMany(e,r={}){for await(let{key:n,value:i}of e)await this.put(n,i,r),yield{key:n,value:i}}async*getMany(e,r={}){for await(let n of e)yield this.get(n,r)}async*deleteMany(e,r={}){for await(let n of e)await this.delete(n,r),yield n}batch(){let e=[],r=[];return{put(n,i){e.push({key:n,value:i})},delete(n){r.push(n)},commit:async n=>{await _e(this.putMany(e,n)),e=[],await _e(this.deleteMany(r,n)),r=[]}}}async*_all(e,r){throw new Error("._all is not implemented")}async*_allKeys(e,r){throw new Error("._allKeys is not implemented")}query(e,r){let n=this._all(e,r);if(e.prefix!=null&&(n=_(n,i=>i.key.toString().startsWith(e.prefix))),Array.isArray(e.filters)&&(n=e.filters.reduce((i,o)=>_(i,o),n)),Array.isArray(e.orders)&&(n=e.orders.reduce((i,o)=>Te(i,o),n)),e.offset!=null){let i=0;n=_(n,()=>i++>=e.offset)}return e.limit!=null&&(n=je(n,e.limit)),n}queryKeys(e,r){let n=this._allKeys(e,r);if(e.prefix!=null&&(n=_(n,i=>i.toString().startsWith(e.prefix))),Array.isArray(e.filters)&&(n=e.filters.reduce((i,o)=>_(i,o),n)),Array.isArray(e.orders)&&(n=e.orders.reduce((i,o)=>Te(i,o),n)),e.offset!=null){let i=0;n=_(n,()=>i++>=e.offset)}return e.limit!=null&&(n=je(n,e.limit)),n}};De.exports=ke});var Ne=c((gr,Re)=>{"use strict";function Fe(t,e){for(let r in e)Object.defineProperty(t,r,{value:e[r],enumerable:!0,configurable:!0});return t}function Lt(t,e,r){if(!t||typeof t=="string")throw new TypeError("Please pass an Error to err-code");r||(r={}),typeof e=="object"&&(r=e,e=""),e&&(r.code=e);try{return Fe(t,r)}catch(n){r.message=t.message,r.stack=t.stack;let i=function(){};return i.prototype=Object.create(Object.getPrototypeOf(t)),Fe(new i,r)}}Re.exports=Lt});var W=c((mr,Oe)=>{"use strict";var k=Ne();function zt(t){return t=t||new Error("Cannot open database"),k(t,"ERR_DB_OPEN_FAILED")}function Ct(t){return t=t||new Error("Delete failed"),k(t,"ERR_DB_DELETE_FAILED")}function Wt(t){return t=t||new Error("Write failed"),k(t,"ERR_DB_WRITE_FAILED")}function Vt(t){return t=t||new Error("Not Found"),k(t,"ERR_NOT_FOUND")}function Pt(t){return t=t||new Error("Aborted"),k(t,"ERR_ABORTED")}Oe.exports={dbOpenFailedError:zt,dbDeleteFailedError:Ct,dbWriteFailedError:Wt,notFoundError:Vt,abortedError:Pt}});var Be=c((br,qe)=>{"use strict";var Ie=L(),Kt=C(),Gt=W(),Me=class extends Kt{constructor(){super();this.data={}}open(){return Promise.resolve()}close(){return Promise.resolve()}async put(e,r){this.data[e.toString()]=r}async get(e){if(!await this.has(e))throw Gt.notFoundError();return this.data[e.toString()]}async has(e){return this.data[e.toString()]!==void 0}async delete(e){delete this.data[e.toString()]}async*_all(){yield*Object.entries(this.data).map(([e,r])=>({key:new Ie(e),value:r}))}async*_allKeys(){yield*Object.entries(this.data).map(([e])=>new Ie(e))}};qe.exports=Me});var Ht=c((Er,Le)=>{"use strict";var Jt=L(),Qt=Be(),Xt=z(),Yt=W(),Zt=C();Le.exports={Key:Jt,MemoryDatastore:Qt,utils:Xt,Errors:Yt,Adapter:Zt}});return Ht();})();
return InterfaceDatastore}));
